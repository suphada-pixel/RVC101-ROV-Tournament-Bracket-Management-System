<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RVC101 ROV Tournament Bracket Management System</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body, html {
      height: 100%;
      font-family: 'Kanit', 'Sarabun', sans-serif;
      overflow-x: hidden;
    }
    
    .app-container {
      width: 100%;
      min-height: 100%;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
      padding: 20px;
      overflow-y: auto;
    }
    
    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
    }
    
    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    .header p {
      font-size: 1.1em;
      opacity: 0.9;
    }
    
    .main-content {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .section {
      background: white;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .section-title {
      font-size: 1.8em;
      color: #1e3c72;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 3px solid #7e22ce;
    }
    
    .team-input-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .team-input-item {
      display: flex;
      flex-direction: column;
    }
    
    .team-input-item label {
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
      font-size: 0.9em;
    }
    
    .team-input-item input {
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1em;
      transition: border-color 0.3s;
    }
    
    .team-input-item input:focus {
      outline: none;
      border-color: #7e22ce;
    }
    
    .button-group {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-top: 20px;
    }
    
    .btn {
      padding: 12px 30px;
      font-size: 1.1em;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      font-family: inherit;
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #7e22ce, #9333ea);
      color: white;
    }
    
    .btn-primary:hover:not(:disabled) {
      background: linear-gradient(135deg, #6b1ba8, #7e22ce);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(126, 34, 206, 0.3);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      color: white;
    }
    
    .btn-secondary:hover:not(:disabled) {
      background: linear-gradient(135deg, #152b54, #1e3c72);
      transform: translateY(-2px);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #059669, #10b981);
      color: white;
    }
    
    .btn-success:hover:not(:disabled) {
      background: linear-gradient(135deg, #047857, #059669);
      transform: translateY(-2px);
    }
    
    .bracket-container {
      overflow-x: auto;
      padding: 20px 0;
    }
    
    .bracket {
      display: flex;
      gap: 40px;
      min-width: max-content;
    }
    
    .bracket-round {
      display: flex;
      flex-direction: column;
      justify-content: space-around;
      min-width: 250px;
    }
    
    .round-title {
      text-align: center;
      font-size: 1.3em;
      font-weight: 700;
      color: #7e22ce;
      margin-bottom: 20px;
      padding: 10px;
      background: linear-gradient(135deg, #faf5ff, #f3e8ff);
      border-radius: 8px;
    }
    
    .match {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      padding: 12px;
      margin: 15px 0;
      transition: all 0.3s;
    }
    
    .match:hover {
      border-color: #7e22ce;
      box-shadow: 0 4px 8px rgba(126, 34, 206, 0.2);
    }
    
    .match-header {
      font-size: 0.85em;
      color: #666;
      margin-bottom: 8px;
      font-weight: 600;
    }
    
    .team {
      padding: 10px;
      margin: 5px 0;
      border-radius: 6px;
      background: #f9fafb;
      border-left: 4px solid #cbd5e1;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .team:hover:not(.empty) {
      background: #f3f4f6;
      border-left-color: #7e22ce;
      transform: translateX(3px);
    }
    
    .team.winner {
      background: linear-gradient(135deg, #d1fae5, #a7f3d0);
      border-left-color: #10b981;
      font-weight: 700;
    }
    
    .team.loser {
      opacity: 0.5;
      text-decoration: line-through;
    }
    
    .team.empty {
      color: #9ca3af;
      font-style: italic;
      cursor: default;
      background: #f9fafb;
    }
    
    .team.empty:hover {
      background: #f9fafb;
      border-left-color: #cbd5e1;
      transform: none;
    }
    
    .placement-brackets {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .placement-group {
      background: linear-gradient(135deg, #fff7ed, #fed7aa);
      border-radius: 10px;
      padding: 15px;
      border: 2px solid #fb923c;
    }
    
    .placement-title {
      font-size: 1.2em;
      font-weight: 700;
      color: #c2410c;
      margin-bottom: 15px;
      text-align: center;
    }
    
    .team-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .team-list-item {
      background: white;
      padding: 10px;
      border-radius: 6px;
      font-weight: 500;
      border-left: 4px solid #fb923c;
    }
    
    .final-rankings {
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      border-radius: 15px;
      padding: 25px;
      margin-top: 20px;
      border: 3px solid #f59e0b;
    }
    
    .final-rankings-title {
      font-size: 2em;
      font-weight: 700;
      color: #b45309;
      text-align: center;
      margin-bottom: 20px;
    }
    
    .rankings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
    }
    
    .rank-item {
      background: white;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #f59e0b;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: transform 0.2s;
    }
    
    .rank-item:hover {
      transform: translateX(5px);
    }
    
    .rank-number {
      font-size: 1.5em;
      font-weight: 700;
      color: #b45309;
      min-width: 60px;
    }
    
    .rank-team {
      font-size: 1.1em;
      font-weight: 600;
      color: #333;
      flex: 1;
    }
    
    .rank-item.top3 {
      background: linear-gradient(135deg, #fff7ed, #ffedd5);
      border-left-width: 6px;
    }
    
    .alert {
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-weight: 500;
    }
    
    .alert-warning {
      background: #fef3c7;
      color: #92400e;
      border-left: 4px solid #f59e0b;
    }
    
    .alert-info {
      background: #dbeafe;
      color: #1e40af;
      border-left: 4px solid #3b82f6;
    }
    
    .alert-success {
      background: #d1fae5;
      color: #065f46;
      border-left: 4px solid #10b981;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      border: 2px solid #7dd3fc;
    }
    
    .stat-value {
      font-size: 2em;
      font-weight: 700;
      color: #0369a1;
    }
    
    .stat-label {
      font-size: 0.9em;
      color: #075985;
      margin-top: 5px;
    }
    
    .loading-spinner {
      display: none;
      text-align: center;
      padding: 20px;
    }
    
    .loading-spinner.active {
      display: block;
    }
    
    .spinner {
      border: 4px solid #f3f4f6;
      border-top: 4px solid #7e22ce;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @media (max-width: 768px) {
      .header h1 {
        font-size: 1.8em;
      }
      
      .team-input-grid {
        grid-template-columns: 1fr;
      }
      
      .button-group {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="app-container">
   <div class="header">
    <h1 id="tournament-title">RVC101 ROV Tournament Bracket Management System By KruTarn</h1>
    <p id="organizer-name">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏™‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡πÅ‡∏û‡πâ‡∏Ñ‡∏±‡∏î‡∏≠‡∏≠‡∏Å ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≤‡∏¢‡∏à‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ñ‡∏£‡∏ö 20 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</p>
   </div>
   <div class="main-content">
    <div class="section" id="team-input-section">
     <h2 class="section-title">üìù ‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô (20 ‡∏ó‡∏µ‡∏°)</h2>
     <div class="team-input-grid" id="team-inputs"></div>
     <div class="button-group"><button class="btn btn-primary" id="draw-btn">üé≤ ‡∏à‡∏±‡∏ö‡∏™‡∏•‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</button> <button class="btn btn-secondary" id="reset-btn">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
     </div>
    </div>
    <div class="loading-spinner" id="loading-spinner">
     <div class="spinner"></div>
     <p style="margin-top: 10px; color: white; font-weight: 600;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</p>
    </div>
    <div class="section" id="final-rankings-section" style="display: none;">
     <div class="final-rankings">
      <div class="final-rankings-title">
       üèÜ ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ (1-20)
      </div>
      <div class="rankings-grid" id="final-rankings-grid"></div>
     </div>
    </div>
    <div class="section" id="bracket-section" style="display: none;">
     <h2 class="section-title">üèÜ ‡∏™‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å (Main Bracket)</h2>
     <div class="alert alert-info" id="bracket-info">
      ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏π‡πà‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô
     </div>
     <div class="button-group" style="margin-bottom: 20px;"><button class="btn btn-secondary" id="edit-mode-btn">‚úèÔ∏è ‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≤‡∏¢</button> <button class="btn btn-success" id="export-image-btn">üì∏ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏û</button>
     </div>
     <div class="bracket-container">
      <div class="bracket" id="main-bracket"></div>
     </div>
    </div>
    <div class="section" id="placement-section" style="display: none;">
     <h2 class="section-title">üìä ‡∏™‡∏≤‡∏¢‡∏à‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö (Placement Brackets)</h2>
     <div class="placement-brackets" id="placement-brackets"></div>
    </div>
    <div class="section" id="stats-section" style="display: none;">
     <h2 class="section-title">üìà ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</h2>
     <div class="stats-grid" id="stats-grid"></div>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      tournament_title: "RVC101 ROV Tournament Bracket Management System",
      organizer_name: "‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏™‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡πÅ‡∏û‡πâ‡∏Ñ‡∏±‡∏î‡∏≠‡∏≠‡∏Å ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≤‡∏¢‡∏à‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ñ‡∏£‡∏ö 20 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö",
      primary_color: "#7e22ce",
      secondary_color: "#1e3c72",
      success_color: "#10b981",
      warning_color: "#fb923c",
      text_color: "#333333"
    };
    
    // ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å
    let matchesMap = new Map();
    let currentRecords = [];
    let isEditMode = false;
    
    // Routing Table - ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞/‡πÅ‡∏û‡πâ ‡πÑ‡∏õ‡πÅ‡∏°‡∏ï‡∏ä‡πå‡πÑ‡∏´‡∏ô ‡∏ä‡πà‡∏≠‡∏á‡πÑ‡∏´‡∏ô
    const ROUTING = {
      // Preliminary Round winners ‚Üí Round of 16
      'PRELIM-1': { winner: { target: 'R16-1', slot: 'team1' }, loser: { target: 'P17-18', slot: 'team1' } },
      'PRELIM-2': { winner: { target: 'R16-1', slot: 'team2' }, loser: { target: 'P17-18', slot: 'team2' } },
      'PRELIM-3': { winner: { target: 'R16-2', slot: 'team1' }, loser: { target: 'P19-20', slot: 'team1' } },
      'PRELIM-4': { winner: { target: 'R16-2', slot: 'team2' }, loser: { target: 'P19-20', slot: 'team2' } },
      
      // Round of 16 ‚Üí Quarterfinals & Placement 9-16
      'R16-1': { winner: { target: 'QF-1', slot: 'team1' }, loser: { target: 'P9-16-1', slot: 'team1' } },
      'R16-2': { winner: { target: 'QF-1', slot: 'team2' }, loser: { target: 'P9-16-1', slot: 'team2' } },
      'R16-3': { winner: { target: 'QF-2', slot: 'team1' }, loser: { target: 'P9-16-2', slot: 'team1' } },
      'R16-4': { winner: { target: 'QF-2', slot: 'team2' }, loser: { target: 'P9-16-2', slot: 'team2' } },
      'R16-5': { winner: { target: 'QF-3', slot: 'team1' }, loser: { target: 'P9-16-3', slot: 'team1' } },
      'R16-6': { winner: { target: 'QF-3', slot: 'team2' }, loser: { target: 'P9-16-3', slot: 'team2' } },
      'R16-7': { winner: { target: 'QF-4', slot: 'team1' }, loser: { target: 'P9-16-4', slot: 'team1' } },
      'R16-8': { winner: { target: 'QF-4', slot: 'team2' }, loser: { target: 'P9-16-4', slot: 'team2' } },
      
      // Quarterfinals ‚Üí Semifinals & Placement 5-8
      'QF-1': { winner: { target: 'SF-1', slot: 'team1' }, loser: { target: 'P5-6', slot: 'team1' } },
      'QF-2': { winner: { target: 'SF-1', slot: 'team2' }, loser: { target: 'P5-6', slot: 'team2' } },
      'QF-3': { winner: { target: 'SF-2', slot: 'team1' }, loser: { target: 'P7-8', slot: 'team1' } },
      'QF-4': { winner: { target: 'SF-2', slot: 'team2' }, loser: { target: 'P7-8', slot: 'team2' } },
      
      // Semifinals ‚Üí Finals & 3rd Place
      'SF-1': { winner: { target: 'FINAL', slot: 'team1' }, loser: { target: 'THIRD', slot: 'team1' } },
      'SF-2': { winner: { target: 'FINAL', slot: 'team2' }, loser: { target: 'THIRD', slot: 'team2' } },
      
      // Placement 9-16 Round 1 ‚Üí Finals
      'P9-16-1': { winner: { target: 'P9-10', slot: 'team1' }, loser: { target: 'P11-12', slot: 'team1' } },
      'P9-16-2': { winner: { target: 'P9-10', slot: 'team2' }, loser: { target: 'P11-12', slot: 'team2' } },
      'P9-16-3': { winner: { target: 'P13-14', slot: 'team1' }, loser: { target: 'P15-16', slot: 'team1' } },
      'P9-16-4': { winner: { target: 'P13-14', slot: 'team2' }, loser: { target: 'P15-16', slot: 'team2' } }
    };
    
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á input ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°
    function initTeamInputs() {
      const container = document.getElementById('team-inputs');
      container.innerHTML = '';
      
      for (let i = 1; i <= 20; i++) {
        const div = document.createElement('div');
        div.className = 'team-input-item';
        div.innerHTML = `
          <label for="team-${i}">‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà ${i}</label>
          <input type="text" id="team-${i}" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏° ${i}" value="‡∏ó‡∏µ‡∏° ${i}">
        `;
        container.appendChild(div);
      }
    }
    
    // ‡∏™‡∏∏‡πà‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡∏°
    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }
    
    // ‡∏à‡∏±‡∏ö‡∏™‡∏•‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô
    async function drawBracket() {
      const teams = [];
      for (let i = 1; i <= 20; i++) {
        const input = document.getElementById(`team-${i}`);
        const teamName = input.value.trim() || `‡∏ó‡∏µ‡∏° ${i}`;
        teams.push(teamName);
      }
      
      const loadingSpinner = document.getElementById('loading-spinner');
      loadingSpinner.classList.add('active');
      
      const shuffled = shuffleArray(teams);
      
      // ‡πÅ‡∏ö‡πà‡∏á‡∏ó‡∏µ‡∏°: 8 ‡∏ó‡∏µ‡∏°‡πÅ‡∏£‡∏Å ‚Üí Preliminary, 12 ‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‚Üí Bye ‡πÄ‡∏Ç‡πâ‡∏≤ R16 ‡πÄ‡∏•‡∏¢
      const prelimTeams = shuffled.slice(0, 8);
      const byeTeams = shuffled.slice(8, 20);
      
      matchesMap.clear();
      
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á Preliminary Round (4 ‡∏Ñ‡∏π‡πà)
      for (let i = 0; i < 4; i++) {
        matchesMap.set(`PRELIM-${i + 1}`, {
          match_id: `PRELIM-${i + 1}`,
          round: 'preliminary',
          team1: prelimTeams[i * 2],
          team2: prelimTeams[i * 2 + 1],
          winner: '',
          match_number: i + 1
        });
      }
      
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á Round of 16 (8 ‡∏Ñ‡∏π‡πà)
      // ‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà 1-2: ‡∏£‡∏≠‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞ Preliminary
      matchesMap.set('R16-1', { match_id: 'R16-1', round: 'round16', team1: '', team2: '', winner: '', match_number: 1 });
      matchesMap.set('R16-2', { match_id: 'R16-2', round: 'round16', team1: '', team2: '', winner: '', match_number: 2 });
      
      // ‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà 3-8: ‡∏ó‡∏µ‡∏° Bye (12 ‡∏ó‡∏µ‡∏°)
      for (let i = 0; i < 6; i++) {
        matchesMap.set(`R16-${i + 3}`, {
          match_id: `R16-${i + 3}`,
          round: 'round16',
          team1: byeTeams[i * 2],
          team2: byeTeams[i * 2 + 1],
          winner: '',
          match_number: i + 3
        });
      }
      
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á Quarterfinals (4 ‡∏Ñ‡∏π‡πà)
      for (let i = 1; i <= 4; i++) {
        matchesMap.set(`QF-${i}`, {
          match_id: `QF-${i}`,
          round: 'quarterfinal',
          team1: '',
          team2: '',
          winner: '',
          match_number: i
        });
      }
      
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á Semifinals (2 ‡∏Ñ‡∏π‡πà)
      for (let i = 1; i <= 2; i++) {
        matchesMap.set(`SF-${i}`, {
          match_id: `SF-${i}`,
          round: 'semifinal',
          team1: '',
          team2: '',
          winner: '',
          match_number: i
        });
      }
      
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á Finals
      matchesMap.set('THIRD', { match_id: 'THIRD', round: 'third-place', team1: '', team2: '', winner: '', match_number: 1 });
      matchesMap.set('FINAL', { match_id: 'FINAL', round: 'final', team1: '', team2: '', winner: '', match_number: 1 });
      
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á Placement Brackets
      matchesMap.set('P5-6', { match_id: 'P5-6', round: 'place5-8', team1: '', team2: '', winner: '', match_number: 1 });
      matchesMap.set('P7-8', { match_id: 'P7-8', round: 'place5-8', team1: '', team2: '', winner: '', match_number: 2 });
      
      for (let i = 1; i <= 4; i++) {
        matchesMap.set(`P9-16-${i}`, { match_id: `P9-16-${i}`, round: 'place9-16', team1: '', team2: '', winner: '', match_number: i });
      }
      
      matchesMap.set('P9-10', { match_id: 'P9-10', round: 'place9-16-final', team1: '', team2: '', winner: '', match_number: 5 });
      matchesMap.set('P11-12', { match_id: 'P11-12', round: 'place9-16-final', team1: '', team2: '', winner: '', match_number: 6 });
      matchesMap.set('P13-14', { match_id: 'P13-14', round: 'place9-16-final', team1: '', team2: '', winner: '', match_number: 7 });
      matchesMap.set('P15-16', { match_id: 'P15-16', round: 'place9-16-final', team1: '', team2: '', winner: '', match_number: 8 });
      
      matchesMap.set('P17-18', { match_id: 'P17-18', round: 'place17-20', team1: '', team2: '', winner: '', match_number: 1 });
      matchesMap.set('P19-20', { match_id: 'P19-20', round: 'place17-20', team1: '', team2: '', winner: '', match_number: 2 });
      
      loadingSpinner.classList.remove('active');
      
      renderBracket();
      updatePlacementBrackets();
      updateStats();
      updateFinalRankings();
      
      document.getElementById('team-input-section').style.display = 'none';
      document.getElementById('bracket-section').style.display = 'block';
      document.getElementById('placement-section').style.display = 'block';
      document.getElementById('stats-section').style.display = 'block';
      document.getElementById('final-rankings-section').style.display = 'block';
    }
    
    // ‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡πÅÔøΩÔøΩ‡πâ‡πÑ‡∏Ç
    function toggleEditMode() {
      isEditMode = !isEditMode;
      const btn = document.getElementById('edit-mode-btn');
      const info = document.getElementById('bracket-info');
      
      if (isEditMode) {
        btn.textContent = '‚úÖ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
        btn.className = 'btn btn-success';
        info.textContent = 'üîß ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠';
        info.className = 'alert alert-warning';
      } else {
        btn.textContent = '‚úèÔ∏è ‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≤‡∏¢';
        btn.className = 'btn btn-secondary';
        info.textContent = '‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏π‡πà‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô';
        info.className = 'alert alert-info';
      }
      
      renderBracket();
      updatePlacementBrackets();
    }
    
    // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°
    function editTeamName(matchId, slot) {
      const match = matchesMap.get(matchId);
      if (!match) return;
      
      const currentName = match[slot];
      if (!currentName) return;
      
      const customModal = document.createElement('div');
      customModal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:1000;';
      customModal.innerHTML = `
        <div style="background:white;padding:30px;border-radius:15px;max-width:400px;width:90%;">
          <p style="font-size:1.2em;color:#1e3c72;font-weight:600;margin-bottom:20px;">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°</p>
          <input type="text" id="edit-team-input" value="${currentName}" style="width:100%;padding:12px;border:2px solid #7e22ce;border-radius:8px;font-size:1em;margin-bottom:20px;">
          <div style="display:flex;gap:10px;justify-content:center;">
            <button id="confirm-edit" style="background:#10b981;color:white;padding:10px 30px;border:none;border-radius:8px;cursor:pointer;font-size:1em;font-weight:600;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            <button id="cancel-edit" style="background:#6b7280;color:white;padding:10px 30px;border:none;border-radius:8px;cursor:pointer;font-size:1em;font-weight:600;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          </div>
        </div>
      `;
      document.body.appendChild(customModal);
      
      const input = document.getElementById('edit-team-input');
      input.focus();
      input.select();
      
      document.getElementById('cancel-edit').onclick = () => customModal.remove();
      
      const saveEdit = () => {
        const newName = input.value.trim();
        if (newName && newName !== currentName) {
          const oldName = match[slot];
          match[slot] = newName;
          
          // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÅ‡∏°‡∏ï‡∏ä‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏°
          matchesMap.forEach(m => {
            if (m.team1 === oldName) m.team1 = newName;
            if (m.team2 === oldName) m.team2 = newName;
            if (m.winner === oldName) m.winner = newName;
          });
          
          renderBracket();
          updatePlacementBrackets();
          updateFinalRankings();
        }
        customModal.remove();
      };
      
      document.getElementById('confirm-edit').onclick = saveEdit;
      input.onkeypress = (e) => {
        if (e.key === 'Enter') saveEdit();
      };
    }
    
    // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞ - ‡∏£‡∏∞‡∏ö‡∏ö Routing ‡∏≠‡∏±‡∏ï‡πÇÔøΩÔøΩÔøΩ‡∏°‡∏±‡∏ïÔøΩÔøΩÔøΩ
    function selectWinner(matchId, winner) {
      const match = matchesMap.get(matchId);
      if (!match || !match.team1 || !match.team2) return;
      
      match.winner = winner;
      const loser = match.team1 === winner ? match.team2 : match.team1;
      
      // ‡πÉ‡∏ä‡πâ Routing Table
      const routes = ROUTING[matchId];
      if (routes) {
        if (routes.winner) {
          const targetMatch = matchesMap.get(routes.winner.target);
          if (targetMatch) {
            targetMatch[routes.winner.slot] = winner;
          }
        }
        if (routes.loser) {
          const targetMatch = matchesMap.get(routes.loser.target);
          if (targetMatch) {
            targetMatch[routes.loser.slot] = loser;
          }
        }
      }
      
      renderBracket();
      updatePlacementBrackets();
      updateStats();
      updateFinalRankings();
    }
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô
    function renderBracket() {
      const container = document.getElementById('main-bracket');
      container.innerHTML = '';
      
      const rounds = [
        { 
          name: '‡∏£‡∏≠‡∏ö‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å', 
          matches: ['PRELIM-1', 'PRELIM-2', 'PRELIM-3', 'PRELIM-4'] 
        },
        { 
          name: '‡∏£‡∏≠‡∏ö 16 ‡∏ó‡∏µ‡∏°', 
          matches: ['R16-1', 'R16-2', 'R16-3', 'R16-4', 'R16-5', 'R16-6', 'R16-7', 'R16-8'] 
        },
        { 
          name: '‡∏£‡∏≠‡∏ö 8 ‡∏ó‡∏µ‡∏°', 
          matches: ['QF-1', 'QF-2', 'QF-3', 'QF-4'] 
        },
        { 
          name: '‡∏£‡∏≠‡∏ö 4 ‡∏ó‡∏µ‡∏°', 
          matches: ['SF-1', 'SF-2'] 
        },
        { 
          name: '‡∏ä‡∏¥‡∏á‡∏ä‡∏ô‡∏∞‡πÄ‡∏•‡∏¥‡∏®', 
          matches: ['THIRD', 'FINAL'] 
        }
      ];
      
      rounds.forEach(round => {
        const roundDiv = document.createElement('div');
        roundDiv.className = 'bracket-round';
        
        const title = document.createElement('div');
        title.className = 'round-title';
        title.textContent = round.name;
        roundDiv.appendChild(title);
        
        round.matches.forEach(matchId => {
          const match = matchesMap.get(matchId);
          if (!match) return;
          
          const matchDiv = document.createElement('div');
          matchDiv.className = 'match';
          
          const header = document.createElement('div');
          header.className = 'match-header';
          header.textContent = `‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà ${match.match_id}`;
          matchDiv.appendChild(header);
          
          // Team 1
          const team1Div = document.createElement('div');
          team1Div.className = 'team';
          if (match.team1) {
            team1Div.textContent = match.team1;
            if (match.winner === match.team1) team1Div.classList.add('winner');
            if (match.winner && match.winner !== match.team1) team1Div.classList.add('loser');
            
            if (isEditMode) {
              team1Div.onclick = () => editTeamName(matchId, 'team1');
              team1Div.style.cursor = 'text';
            } else {
              team1Div.onclick = () => selectWinner(matchId, match.team1);
              team1Div.style.cursor = 'pointer';
            }
          } else {
            team1Div.textContent = '‡∏£‡∏≠‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô';
            team1Div.classList.add('empty');
          }
          matchDiv.appendChild(team1Div);
          
          // Team 2
          const team2Div = document.createElement('div');
          team2Div.className = 'team';
          if (match.team2) {
            team2Div.textContent = match.team2;
            if (match.winner === match.team2) team2Div.classList.add('winner');
            if (match.winner && match.winner !== match.team2) team2Div.classList.add('loser');
            
            if (isEditMode) {
              team2Div.onclick = () => editTeamName(matchId, 'team2');
              team2Div.style.cursor = 'text';
            } else {
              team2Div.onclick = () => selectWinner(matchId, match.team2);
              team2Div.style.cursor = 'pointer';
            }
          } else {
            team2Div.textContent = '‡∏£‡∏≠‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô';
            team2Div.classList.add('empty');
          }
          matchDiv.appendChild(team2Div);
          
          roundDiv.appendChild(matchDiv);
        });
        
        container.appendChild(roundDiv);
      });
    }
    
    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏≤‡∏¢‡∏à‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö
    function updatePlacementBrackets() {
      const container = document.getElementById('placement-brackets');
      container.innerHTML = '';
      
      const groups = [
        { title: '5-8', matches: ['P5-6', 'P7-8'] },
        { title: '9-16', matches: ['P9-16-1', 'P9-16-2', 'P9-16-3', 'P9-16-4', 'P9-10', 'P11-12', 'P13-14', 'P15-16'] },
        { title: '17-20', matches: ['P17-18', 'P19-20'] }
      ];
      
      groups.forEach(group => {
        const groupDiv = document.createElement('div');
        groupDiv.className = 'placement-group';
        
        const title = document.createElement('div');
        title.className = 'placement-title';
        title.textContent = `‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ä‡∏¥‡∏á‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ${group.title}`;
        groupDiv.appendChild(title);
        
        group.matches.forEach(matchId => {
          const match = matchesMap.get(matchId);
          if (!match) return;
          
          const matchDiv = document.createElement('div');
          matchDiv.className = 'match';
          matchDiv.style.marginBottom = '10px';
          
          const header = document.createElement('div');
          header.className = 'match-header';
          header.textContent = `‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà ${match.match_id}`;
          matchDiv.appendChild(header);
          
          const team1Div = document.createElement('div');
          team1Div.className = 'team';
          if (match.team1) {
            team1Div.textContent = match.team1;
            if (match.winner === match.team1) team1Div.classList.add('winner');
            if (match.winner && match.winner !== match.team1) team1Div.classList.add('loser');
            
            if (isEditMode) {
              team1Div.onclick = () => editTeamName(matchId, 'team1');
              team1Div.style.cursor = 'text';
            } else {
              team1Div.onclick = () => selectWinner(matchId, match.team1);
              team1Div.style.cursor = 'pointer';
            }
          } else {
            team1Div.textContent = '‡∏£‡∏≠‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô';
            team1Div.classList.add('empty');
          }
          matchDiv.appendChild(team1Div);
          
          const team2Div = document.createElement('div');
          team2Div.className = 'team';
          if (match.team2) {
            team2Div.textContent = match.team2;
            if (match.winner === match.team2) team2Div.classList.add('winner');
            if (match.winner && match.winner !== match.team2) team2Div.classList.add('loser');
            
            if (isEditMode) {
              team2Div.onclick = () => editTeamName(matchId, 'team2');
              team2Div.style.cursor = 'text';
            } else {
              team2Div.onclick = () => selectWinner(matchId, match.team2);
              team2Div.style.cursor = 'pointer';
            }
          } else {
            team2Div.textContent = '‡∏£‡∏≠‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô';
            team2Div.classList.add('empty');
          }
          matchDiv.appendChild(team2Div);
          
          groupDiv.appendChild(matchDiv);
        });
        
        container.appendChild(groupDiv);
      });
    }
    
    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
    function calculateFinalRankings() {
      const rankings = [];
      
      const rankingMatches = [
        { pos: [1, 2], matchId: 'FINAL', winnerRank: 1 },
        { pos: [3, 4], matchId: 'THIRD', winnerRank: 3 },
        { pos: [5, 6], matchId: 'P5-6', winnerRank: 5 },
        { pos: [7, 8], matchId: 'P7-8', winnerRank: 7 },
        { pos: [9, 10], matchId: 'P9-10', winnerRank: 9 },
        { pos: [11, 12], matchId: 'P11-12', winnerRank: 11 },
        { pos: [13, 14], matchId: 'P13-14', winnerRank: 13 },
        { pos: [15, 16], matchId: 'P15-16', winnerRank: 15 },
        { pos: [17, 18], matchId: 'P17-18', winnerRank: 17 },
        { pos: [19, 20], matchId: 'P19-20', winnerRank: 19 }
      ];
      
      rankingMatches.forEach(rm => {
        const match = matchesMap.get(rm.matchId);
        if (match && match.winner) {
          const loser = match.team1 === match.winner ? match.team2 : match.team1;
          rankings.push({ position: rm.winnerRank, team: match.winner, medal: rm.winnerRank === 1 ? 'ü•á' : rm.winnerRank === 3 ? 'ü•â' : rm.winnerRank === 2 ? 'ü•à' : '' });
          rankings.push({ position: rm.winnerRank + 1, team: loser, medal: '' });
        }
      });
      
      return rankings.sort((a, b) => a.position - b.position);
    }
    
    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
    function updateFinalRankings() {
      const container = document.getElementById('final-rankings-grid');
      container.innerHTML = '';
      
      const rankings = calculateFinalRankings();
      
      for (let i = 1; i <= 20; i++) {
        const rank = rankings.find(r => r.position === i);
        const rankItem = document.createElement('div');
        rankItem.className = 'rank-item';
        if (i <= 3) rankItem.classList.add('top3');
        
        if (rank && rank.team) {
          rankItem.innerHTML = `
            <div class="rank-number">${rank.medal} ${i}</div>
            <div class="rank-team">${rank.team}</div>
          `;
        } else {
          rankItem.innerHTML = `
            <div class="rank-number">${i}</div>
            <div class="rank-team" style="color: #9ca3af; font-style: italic;">‡∏£‡∏≠‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</div>
          `;
        }
        
        container.appendChild(rankItem);
      }
    }
    
    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
    function updateStats() {
      const container = document.getElementById('stats-grid');
      
      const totalMatches = matchesMap.size;
      const completedMatches = Array.from(matchesMap.values()).filter(m => m.winner).length;
      const pendingMatches = totalMatches - completedMatches;
      const progress = Math.round((completedMatches / totalMatches) * 100);
      
      container.innerHTML = `
        <div class="stat-card">
          <div class="stat-value">${totalMatches}</div>
          <div class="stat-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${completedMatches}</div>
          <div class="stat-label">‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${pendingMatches}</div>
          <div class="stat-label">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${progress}%</div>
          <div class="stat-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</div>
        </div>
      `;
    }
    
    // ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏û
    async function exportToImage() {
      const exportBtn = document.getElementById('export-image-btn');
      exportBtn.disabled = true;
      exportBtn.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û...';
      
      const captureArea = document.createElement('div');
      captureArea.style.cssText = 'position:absolute;left:-9999px;top:0;background:linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);padding:40px;border-radius:20px;';
      
      const header = document.createElement('div');
      header.style.cssText = 'text-align:center;color:white;margin-bottom:30px;padding:20px;background:rgba(0,0,0,0.3);border-radius:15px;';
      header.innerHTML = `
        <h1 style="font-size:2.5em;margin:0 0 10px 0;text-shadow:2px 2px 4px rgba(0,0,0,0.5);font-family:'Kanit','Sarabun',sans-serif;">${document.getElementById('tournament-title').textContent}</h1>
        <p style="font-size:1.1em;margin:0;opacity:0.9;font-family:'Kanit','Sarabun',sans-serif;">${document.getElementById('organizer-name').textContent}</p>
      `;
      captureArea.appendChild(header);
      
      const mainBracket = document.getElementById('main-bracket').cloneNode(true);
      mainBracket.style.cssText = 'display:flex;gap:40px;';
      
      const bracketSection = document.createElement('div');
      bracketSection.style.cssText = 'background:white;border-radius:15px;padding:25px;box-shadow:0 4px 6px rgba(0,0,0,0.1);';
      
      const title = document.createElement('h2');
      title.style.cssText = 'font-size:1.8em;color:#1e3c72;margin:0 0 20px 0;padding-bottom:10px;border-bottom:3px solid #7e22ce;font-family:\'Kanit\',\'Sarabun\',sans-serif;';
      title.textContent = 'üèÜ ‡∏™‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å (Main Bracket)';
      bracketSection.appendChild(title);
      bracketSection.appendChild(mainBracket);
      
      captureArea.appendChild(bracketSection);
      
      const placementBrackets = document.getElementById('placement-brackets').cloneNode(true);
      placementBrackets.style.cssText = 'display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-top:20px;';
      
      const placementSection = document.createElement('div');
      placementSection.style.cssText = 'background:white;border-radius:15px;padding:25px;box-shadow:0 4px 6px rgba(0,0,0,0.1);margin-top:20px;';
      
      const placementTitle = document.createElement('h2');
      placementTitle.style.cssText = 'font-size:1.8em;color:#1e3c72;margin:0 0 20px 0;padding-bottom:10px;border-bottom:3px solid #7e22ce;font-family:\'Kanit\',\'Sarabun\',sans-serif;';
      placementTitle.textContent = 'üìä ‡∏™‡∏≤‡∏¢‡∏à‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö (Placement Brackets)';
      placementSection.appendChild(placementTitle);
      placementSection.appendChild(placementBrackets);
      
      captureArea.appendChild(placementSection);
      
      const rankingsGrid = document.getElementById('final-rankings-grid').cloneNode(true);
      const rankingsSection = document.createElement('div');
      rankingsSection.style.cssText = 'background:white;border-radius:15px;padding:25px;box-shadow:0 4px 6px rgba(0,0,0,0.1);margin-top:20px;';
      
      const rankingsOuter = document.createElement('div');
      rankingsOuter.style.cssText = 'background:linear-gradient(135deg,#fef3c7,#fde68a);border-radius:15px;padding:25px;border:3px solid #f59e0b;';
      
      const rankingsTitle = document.createElement('div');
      rankingsTitle.style.cssText = 'font-size:2em;font-weight:700;color:#b45309;text-align:center;margin-bottom:20px;font-family:\'Kanit\',\'Sarabun\',sans-serif;';
      rankingsTitle.textContent = 'üèÜ ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ (1-20)';
      
      rankingsOuter.appendChild(rankingsTitle);
      rankingsOuter.appendChild(rankingsGrid);
      rankingsSection.appendChild(rankingsOuter);
      captureArea.appendChild(rankingsSection);
      
      const footer = document.createElement('div');
      footer.style.cssText = 'text-align:center;color:white;margin-top:20px;padding:15px;font-size:0.9em;opacity:0.8;font-family:\'Kanit\',\'Sarabun\',sans-serif;';
      footer.textContent = `‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏ö‡∏™‡∏•‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô ROV | ${new Date().toLocaleDateString('th-TH')}`;
      captureArea.appendChild(footer);
      
      document.body.appendChild(captureArea);
      
      try {
        const canvas = await html2canvas(captureArea, {
          backgroundColor: null,
          scale: 2,
          logging: false,
          useCORS: true
        });
        
        canvas.toBlob((blob) => {
          const url = URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.href = url;
          link.download = `‡∏™‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô-${new Date().toLocaleDateString('th-TH').replace(/\//g, '-')}.png`;
          link.click();
          URL.revokeObjectURL(url);
          
          exportBtn.disabled = false;
          exportBtn.textContent = 'üì∏ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏û';
          
          const successModal = document.createElement('div');
          successModal.style.cssText = 'position:fixed;top:20px;right:20px;background:#10b981;color:white;padding:20px 30px;border-radius:10px;box-shadow:0 4px 6px rgba(0,0,0,0.2);z-index:2000;font-weight:600;';
          successModal.textContent = '‚úÖ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
          document.body.appendChild(successModal);
          
          setTimeout(() => successModal.remove(), 3000);
        });
      } catch (error) {
        console.error('Error generating image:', error);
        exportBtn.disabled = false;
        exportBtn.textContent = 'üì∏ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏û';
        
        const errorModal = document.createElement('div');
        errorModal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:1000;';
        errorModal.innerHTML = '<div style="background:white;padding:30px;border-radius:15px;max-width:400px;text-align:center;"><p style="font-size:1.2em;color:#dc2626;font-weight:600;margin-bottom:15px;">‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û</p><button onclick="this.parentElement.parentElement.remove()" style="background:#7e22ce;color:white;padding:10px 30px;border:none;border-radius:8px;cursor:pointer;font-size:1em;font-weight:600;">‡∏ï‡∏Å‡∏•‡∏á</button></div>';
        document.body.appendChild(errorModal);
      } finally {
        document.body.removeChild(captureArea);
      }
    }
    
    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô
    async function saveResults() {
      if (!window.dataSdk) {
        const customModal = document.createElement('div');
        customModal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000;';
        customModal.innerHTML = '<div style="background:white;padding:30px;border-radius:15px;max-width:400px;text-align:center;"><p style="font-size:1.2em;color:#dc2626;font-weight:600;margin-bottom:15px;">‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</p><button onclick="this.parentElement.parentElement.remove()" style="background:#7e22ce;color:white;padding:10px 30px;border:none;border-radius:8px;cursor:pointer;font-size:1em;font-weight:600;">‡∏ï‡∏Å‡∏•‡∏á</button></div>';
        document.body.appendChild(customModal);
        return;
      }
      
      if (currentRecords.length >= 999) {
        const customModal = document.createElement('div');
        customModal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000;';
        customModal.innerHTML = '<div style="background:white;padding:30px;border-radius:15px;max-width:400px;text-align:center;"><p style="font-size:1.2em;color:#dc2626;font-weight:600;margin-bottom:15px;">‚ö†Ô∏è ‡∏ñ‡∏∂‡∏á‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (999 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</p><button onclick="this.parentElement.parentElement.remove()" style="background:#7e22ce;color:white;padding:10px 30px;border:none;border-radius:8px;cursor:pointer;font-size:1em;font-weight:600;">‡∏ï‡∏Å‡∏•‡∏á</button></div>';
        document.body.appendChild(customModal);
        return;
      }
      
      const saveBtn = document.getElementById('save-results-btn');
      saveBtn.disabled = true;
      saveBtn.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
      
      for (const record of currentRecords) {
        await window.dataSdk.delete(record);
      }
      
      for (const [matchId, match] of matchesMap) {
        const result = await window.dataSdk.create({
          match_id: match.match_id,
          round: match.round,
          team1: match.team1,
          team2: match.team2,
          winner: match.winner,
          match_number: match.match_number
        });
        
        if (!result.isOk) {
          console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:', result.error);
        }
      }
      
      saveBtn.disabled = false;
      saveBtn.textContent = '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
      
      setTimeout(() => {
        saveBtn.textContent = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô';
      }, 2000);
    }
    
    // ÔøΩÔøΩ‡∏µ‡πÄ‡∏ã‡πá‡∏ï
    async function resetAll() {
      const customModal = document.createElement('div');
      customModal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:1000;';
      customModal.innerHTML = '<div style="background:white;padding:30px;border-radius:15px;max-width:400px;text-align:center;"><p style="font-size:1.2em;color:#dc2626;font-weight:600;margin-bottom:20px;">‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p><div style="display:flex;gap:10px;justify-content:center;"><button id="confirm-reset" style="background:#dc2626;color:white;padding:10px 30px;border:none;border-radius:8px;cursor:pointer;font-size:1em;font-weight:600;">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button><button id="cancel-reset" style="background:#6b7280;color:white;padding:10px 30px;border:none;border-radius:8px;cursor:pointer;font-size:1em;font-weight:600;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button></div></div>';
      document.body.appendChild(customModal);
      
      document.getElementById('cancel-reset').onclick = () => customModal.remove();
      document.getElementById('confirm-reset').onclick = async () => {
        customModal.remove();
        
        if (window.dataSdk && currentRecords.length > 0) {
          for (const record of currentRecords) {
            await window.dataSdk.delete(record);
          }
        }
        
        matchesMap.clear();
        currentRecords = [];
        
        document.getElementById('team-input-section').style.display = 'block';
        document.getElementById('bracket-section').style.display = 'none';
        document.getElementById('placement-section').style.display = 'none';
        document.getElementById('stats-section').style.display = 'none';
        document.getElementById('final-rankings-section').style.display = 'none';
        
        initTeamInputs();
      };
    }
    
    // Data SDK Handler
    const dataHandler = {
      onDataChanged(data) {
        currentRecords = data;
        
        if (data.length > 0) {
          matchesMap.clear();
          data.forEach(match => {
            matchesMap.set(match.match_id, match);
          });
          
          renderBracket();
          updatePlacementBrackets();
          updateStats();
          updateFinalRankings();
          
          document.getElementById('team-input-section').style.display = 'none';
          document.getElementById('bracket-section').style.display = 'block';
          document.getElementById('placement-section').style.display = 'block';
          document.getElementById('stats-section').style.display = 'block';
          document.getElementById('final-rankings-section').style.display = 'block';
        }
      }
    };
    
    // Element SDK
    async function onConfigChange(config) {
      const titleElement = document.getElementById('tournament-title');
      const organizerElement = document.getElementById('organizer-name');
      
      if (titleElement) {
        titleElement.textContent = config.tournament_title || defaultConfig.tournament_title;
      }
      
      if (organizerElement) {
        organizerElement.textContent = config.organizer_name || defaultConfig.organizer_name;
      }
    }
    
    function mapToCapabilities(config) {
      return {
        recolorables: [
          {
            get: () => config.primary_color || defaultConfig.primary_color,
            set: (value) => {
              config.primary_color = value;
              window.elementSdk.setConfig({ primary_color: value });
            }
          },
          {
            get: () => config.secondary_color || defaultConfig.secondary_color,
            set: (value) => {
              config.secondary_color = value;
              window.elementSdk.setConfig({ secondary_color: value });
            }
          },
          {
            get: () => config.success_color || defaultConfig.success_color,
            set: (value) => {
              config.success_color = value;
              window.elementSdk.setConfig({ success_color: value });
            }
          }
        ],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }
    
    function mapToEditPanelValues(config) {
      return new Map([
        ["tournament_title", config.tournament_title || defaultConfig.tournament_title],
        ["organizer_name", config.organizer_name || defaultConfig.organizer_name]
      ]);
    }
    
    // Initialize
    async function init() {
      initTeamInputs();
      
      if (window.dataSdk) {
        const initResult = await window.dataSdk.init(dataHandler);
        if (!initResult.isOk) {
          console.error('Failed to initialize Data SDK');
        }
      }
      
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities,
          mapToEditPanelValues
        });
      }
      
      document.getElementById('draw-btn').addEventListener('click', drawBracket);
      document.getElementById('reset-btn').addEventListener('click', resetAll);
      
      const editModeBtn = document.getElementById('edit-mode-btn');
      if (editModeBtn) {
        editModeBtn.addEventListener('click', toggleEditMode);
      }
      
      const exportImageBtn = document.getElementById('export-image-btn');
      if (exportImageBtn) {
        exportImageBtn.addEventListener('click', exportToImage);
      }
    }
    
    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9ae9bb68f24b45b2',t:'MTc2NTg0MTQ2MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
